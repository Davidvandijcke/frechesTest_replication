% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/frechesTest.R
\name{frechesTest}
\alias{frechesTest}
\title{Test for Jumps in Metric-Space Conditional Frechet Means}
\usage{
frechesTest(
  Y_obj,
  X_scalar,
  c_val,
  metric_space_type,
  h_frechet = "CV",
  kernel_frechet_char = "epan",
  frechet_optns = list(),
  h_fx = NULL,
  kernel_fx_char = "gauss",
  cv_K_folds = 5,
  cv_n_bw_candidates = 10,
  undersmooth_factor = 0.9,
  min_eff_points_cv_fold = 5,
  min_bw_cv_factor = 0.001,
  verbose = FALSE
)
}
\arguments{
\item{Y_obj}{A list of observed metric objects. Each element corresponds to one
observation. For \code{metric_space_type = "density"}, elements can be raw 
numeric vectors, histogram objects, or specific quantile lists. For 
\code{"covariance"} or \code{"correlation"}, elements should be matrices. 
For \code{"sphere"}, elements should be numeric unit vectors. For 
\code{"network"}, elements should be graph Laplacian matrices.}

\item{X_scalar}{A numeric vector of scalar covariates, corresponding to \code{Y_obj}.
Must have the same length as \code{Y_obj}.}

\item{c_val}{The scalar cutoff point in \code{X_scalar} where the discontinuity 
is tested, splitting the data into \code{X_scalar >= c} and \code{X_scalar < c}.}

\item{metric_space_type}{A character string specifying the type of metric space.
Supported types: \code{"density"} (for probability distributions using 
Wasserstein-2 distance), \code{"covariance"} (for SPD matrices), 
\code{"correlation"} (for correlation matrices), \code{"sphere"} (for unit 
vectors on hypersphere), \code{"network"} (for graph Laplacians).}

\item{h_frechet}{Bandwidth for local Frechet regression. Can be:
\itemize{
  \item Numeric scalar: Fixed bandwidth value
  \item \code{"CV"}: Use K-fold cross-validation for automatic selection
}}

\item{kernel_frechet_char}{Character string specifying the kernel function for 
local Frechet regression weights. Options include \code{"gauss"}, \code{"epan"}, 
\code{"rect"}, \code{"quar"}. Default is \code{"epan"}.}

\item{frechet_optns}{A list of options specific to the \code{metric_space_type}:
\itemize{
  \item For \code{"density"}:
    \itemize{
      \item \code{qSup}: (Required) Numeric vector spanning [0,1] for quantile grid
      \item \code{den_opts_for_create_density}: Options for \code{frechet::CreateDensity}
      \item \code{lower}, \code{upper}: Bounds for quantile function support
      \item \code{osqp_model_for_density_proj}: Cached OSQP model for optimization
    }
  \item For \code{"covariance"} or \code{"correlation"}:
    \itemize{
      \item \code{metric}: Distance metric (\code{"frobenius"}, \code{"power"}, 
            \code{"log_cholesky"}, \code{"cholesky"})
      \item \code{alpha}: Power parameter for \code{"power"} metric
    }
  \item For \code{"network"}:
    \itemize{
      \item \code{network_directed}: Logical, whether graphs are directed. Default FALSE.
      \item \code{W_laplacian_bound}: Upper bound for edge weights
      \item \code{osqp_model_for_laplacian_proj}: Cached OSQP model
    }
   \item For \code{"sphere"}:
   \itemize{
   \item \code{enforce_positive}: Logical, whether to force Frechet mean into
   positive orthant. Default FALSE. 
   }
   }}

\item{h_fx}{Numeric scalar, bandwidth for estimating the density of \code{X_scalar} 
at \code{c_val}. If \code{NULL}, uses \code{stats::bw.nrd0(X_scalar)}.}

\item{kernel_fx_char}{Character string, kernel for density estimation of X. 
Default is \code{"gauss"}.}

\item{cv_K_folds}{Integer, number of folds for cross-validation when 
\code{h_frechet = "CV"}. Default is 5.}

\item{cv_n_bw_candidates}{Integer, number of bandwidth candidates to test 
during cross-validation. Default is 10.}

\item{undersmooth_factor}{Numeric, factor for undersmoothing the selected 
bandwidth for variance estimation. Default is 0.9.}

\item{min_eff_points_cv_fold}{Integer, minimum effective sample size required 
in each CV fold. Default is 5.}

\item{min_bw_cv_factor}{Numeric, minimum bandwidth as fraction of data range. 
Default is 0.001.}

\item{verbose}{Logical, whether to print progress messages. Default is \code{FALSE}.}
}
\value{
A list containing:
  \item{Tn}{The test statistic value}
  \item{p_value}{P-value based on Chi-squared distribution with 1 df}
  \item{V_hat_plus}{Estimated conditional Frechet variance from the right of \code{c_val}}
  \item{V_hat_minus}{Estimated conditional Frechet variance from the left of \code{c_val}}
  \item{V_hat_pooled}{Estimated pooled conditional Frechet variance around \code{c_val}}
  \item{sigma_V_sq_hat_plus}{Estimated variance of squared distances from the right}
  \item{sigma_V_sq_hat_minus}{Estimated variance of squared distances from the left}
  \item{f_X_hat_c}{Estimated density of X at cutoff point}
  \item{S_K}{Kernel constant for asymptotic distribution}
  \item{lambda_hat}{Estimated mixing proportion}
  \item{F_n}{Mean difference component of test statistic}
  \item{U_n}{Variance difference component of test statistic}
  \item{l_hat_plus}{Estimated Frechet mean from the right}
  \item{l_hat_minus}{Estimated Frechet mean from the left}
  \item{l_hat_pooled}{Estimated pooled Frechet mean}
  \item{kernel_constants}{List of computed kernel moments}
  \item{num_active_plus}{Number of observations with non-zero weights (right side)}
  \item{num_active_minus}{Number of observations with non-zero weights (left side)}
  \item{num_active_pooled}{Number of observations with non-zero pooled weights}
  \item{h_mean_cv_selected}{Selected bandwidth (if CV was used)}
  \item{h_variance_used}{Bandwidth used for variance estimation}
  \item{D_n_U_denominator}{Denominator of U component}
  \item{D_n_F_denominator}{Denominator of F component}
  \item{error}{Error message if computation failed, otherwise NULL}
}
\description{
Implements an ANOVA-style test for detecting discontinuities (jumps) in the 
conditional Frechet mean of random objects valued in arbitrary metric spaces.
The test is based on the methodology described in "A Test for Jumps in 
Metric-Space Conditional Means" by David Van Dijcke.
}
\details{
The test combines differences in estimated Frechet means and variances from both 
sides of the cutoff. The test statistic follows a Chi-squared distribution with 
1 degree of freedom under the null hypothesis of no jump.

For \code{metric_space_type = "density"}, observations can be:
\itemize{
  \item Numeric vectors (raw data)
  \item Lists with \code{q} (quantile values), \code{qSup} (support), and \code{type="quantile"}
  \item Histogram objects with \code{mids}, \code{counts}, \code{breaks}
}

The \code{frechet_optns$qSup} parameter is essential for density space computations
as it defines the common grid for L2-Wasserstein distance calculations.
}
\examples{
\dontrun{
# Example 1: Density space with jump in mean
set.seed(123)
n <- 100
X <- runif(n)
Y <- vector("list", n)

for(i in 1:n) {
  if (X[i] < 0.5) {
    Y[[i]] <- rnorm(50, mean = 0, sd = 1)
  } else {
    Y[[i]] <- rnorm(50, mean = 2, sd = 1)  # Jump in mean
  }
}

result_density <- frechesTest(
  Y_obj = Y,
  X_scalar = X,
  c_val = 0.5,
  metric_space_type = "density",
  h_frechet = "CV",
  frechet_optns = list(qSup = seq(0.01, 0.99, length.out = 99))
)

print(paste("P-value:", result_density$p_value))

# Example 2: Covariance space
if (requireNamespace("MASS", quietly = TRUE)) {
  Y_cov <- vector("list", n)
  for(i in 1:n) {
    if (X[i] < 0.5) {
      Sigma <- diag(3)
    } else {
      Sigma <- diag(c(2, 2, 2))  # Jump in scale
    }
    data <- MASS::mvrnorm(30, mu = rep(0, 3), Sigma = Sigma)
    Y_cov[[i]] <- cov(data)
  }
  
  result_cov <- frechesTest(
    Y_obj = Y_cov,
    X_scalar = X,
    c_val = 0.5,
    metric_space_type = "covariance",
    h_frechet = 0.2,
    frechet_optns = list(metric = "frobenius")
  )
  
  print(paste("P-value:", result_cov$p_value))
}
}

}
\references{
Van Dijcke, D. (2023). "A Test for Jumps in Metric-Space Conditional Means." 
Working Paper, University of Michigan.
}
